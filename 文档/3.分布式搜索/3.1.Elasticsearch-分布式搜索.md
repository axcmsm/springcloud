### åˆ†å¸ƒå¼æœç´¢ Elasticsearch

å¼€æºçš„åˆ†å¸ƒå¼æœç´¢å¼•æ“ï¼Œç”¨æ¥å®ç°ï¼Œæ—¥å¿—ç»Ÿè®¡ï¼Œåˆ†æï¼Œç³»ç»Ÿç›‘æ§ç­‰åŠŸèƒ½ã€‚

ELK: Elasticsearch + Beats + Kibana + kibana ç­‰æŠ€æœ¯æ ˆ

Luceneï¼šæ˜¯Apacheå¼€æºçš„æœç´¢å¼•æ“ç±»åº“ï¼Œæä¾›äº†æœç´¢å¼•æ“çš„æ ¸å¿ƒAPI

å€’æ’ç´¢å¼•ï¼š

- æ–‡æ¡£(document)ï¼šæ¯æ¡æ•°æ®å°±æ˜¯ä¸€ä¸ªæ–‡æ¡£
- è¯æ¡ï¼ˆtermï¼‰ï¼šæ–‡æ¡£æŒ‰ç…§è¯­ä¹‰åˆ†å±‚çš„è¯è¯­
  ![å€’æ’ç´¢å¼•](./img/3.1.1img.png)

æœç´¢ => åˆ†è¯ => æ ¹æ®è¯æ¡æŸ¥æ‰¾æ–‡æ¡£id => æ ¹æ®æ–‡æ¡£idæŸ¥æ‰¾æ–‡æ¡£ => å­˜å…¥ç»“æœé›†
> è™½ç„¶æ˜¯ç»å†äº†ä¿©æ¬¡æŸ¥è¯¢ï¼Œä½†éƒ½æ˜¯æ ¹æ®ç´¢å¼•è¿›è¡ŒæŸ¥è¯¢çš„ï¼Œæ•ˆç‡ç›¸å¯¹ä¸é€è¡ŒæŸ¥è¯¢æ˜¯è¦å¿«ä¸Šä¸å°‘çš„ã€‚

**Esä¸Mysqlå¯¹æ¯”**:
![esä¸mysqlå¯¹æ¯”](./img/3.1.2img.png)

- Mysqlï¼šæ“…é•¿äº‹åŠ¡ç±»å‹æ“ä½œï¼Œå¯ä»¥ç¡®ä¿æ•°æ®çš„å®‰å…¨å’Œä¸€è‡´æ€§
- ESï¼šæ“…é•¿æµ·é‡æ•°æ®çš„æœç´¢ï¼Œåˆ†æï¼Œè®¡ç®—

---

### éƒ¨ç½²

**docker(å•èŠ‚ç‚¹)**ï¼š

```shell
# åˆ›å»ºesç½‘ç»œ
docker network create es-net
```

**å®‰è£…ES**:

1. æ‹‰å–Elasticsearché•œåƒï¼šåœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤æ¥ä¸‹è½½Elasticsearchçš„æœ€æ–°ç‰ˆæœ¬é•œåƒï¼š

```shell
docker pull elasticsearch:7.12.0

```

2. åˆ›å»ºå¹¶å¯åŠ¨Elasticsearchå®¹å™¨ï¼šä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªåä¸ºâ€œesâ€çš„å®¹å™¨ï¼š

```shell
docker run -d --name es --network es-net   -p 9200:9200 -p 9300:9300 -e "discovery.type=single-node" elasticsearch:7.12.0

#-d å‚æ•°ä½¿å®¹å™¨åœ¨åå°è¿è¡Œã€‚
#--name å‚æ•°æŒ‡å®šå®¹å™¨çš„åç§°ã€‚
#-p å‚æ•°å°†å®¹å™¨çš„ 9200 å’Œ 9300 ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„å¯¹åº”ç«¯å£ã€‚
#-e å‚æ•°è®¾ç½®Elasticsearchçš„é…ç½®é€‰é¡¹ã€‚
#-v å°†æ•°æ®ç›®å½•å’Œæ’ä»¶ç›®å½•æŒ‚è½½åˆ°å¤–é¢ï¼ˆå¯é€‰ï¼‰
#--network es-net  # docker network create es-net
# --privileged å‚æ•°è¡¨ç¤ºåœ¨å®¹å™¨å†…å¼€å¯ç‰¹æƒæ¨¡å¼ï¼Œå³ç»™äºˆå®¹å™¨ä¸­çš„è¿›ç¨‹è¶…çº§æƒé™ï¼Œä½¿å…¶èƒ½å¤Ÿä½¿ç”¨ä¸»æœºçš„æ‰€æœ‰è®¾å¤‡å’Œç³»ç»ŸåŠŸèƒ½ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†ä¾¿äºåœ¨å®¹å™¨ä¸­æ‰§è¡Œéœ€è¦ç‰¹æ®Šæƒé™çš„ä»»åŠ¡ï¼Œä¾‹å¦‚è®¾å¤‡ç®¡ç†å’Œè°ƒè¯•ç­‰ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨è¯¥å‚æ•°ä¹Ÿå¯èƒ½ä¼šæš´éœ²ä¸»æœºç³»ç»Ÿçš„å®‰å…¨é£é™©ã€‚
#elasticsearch:7.12.0 æ˜¯å…ˆå‰ä¸‹è½½çš„Elasticsearché•œåƒã€‚
# -v es-data:/usr/share/elasticsearch/data -v es-plugins:/usr/share/elasticsearch/plugins
```

3. æµ‹è¯•ï¼šç­‰å¾…Elasticsearchå¯åŠ¨æˆåŠŸåï¼Œåœ¨æµè§ˆå™¨ä¸­è¾“å…¥ <http://your_server_ip:9200>

**kibana**:

1. æ‰“å¼€ç»ˆç«¯å¹¶è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œæ‹‰å–Kibana 7.12.0 ç‰ˆæœ¬é•œåƒã€‚

```shell
docker pull kibana:7.12.0
```

2. åˆ›å»ºä¸€ä¸ªKibanaå®¹å™¨ï¼š

```shell
#docker run --name kibana --link my-es-container:elasticsearch -p 5601:5601 -d kibana:7.12.0
docker run --name kibana --network=es-net -e ELASTICSEARCH_HOSTS=http://es:9200 -p 5601:5601 -d kibana:7.12.0
# --name å‚æ•°æŒ‡å®šå®¹å™¨çš„åç§°ä¸ºâ€œkibanaâ€ã€‚
# --link å‚æ•°å°†Kibanaå®¹å™¨ä¸å…ˆå‰åˆ›å»ºçš„Elasticsearchå®¹å™¨è¿æ¥åœ¨ä¸€èµ·ï¼Œä½¿å®ƒä»¬å¯ä»¥ç›¸äº’é€šä¿¡ã€‚my-es-container æ˜¯å…ˆå‰åˆ›å»ºçš„Elasticsearchå®¹å™¨çš„åç§°ã€‚
# -p å‚æ•°å°†å®¹å™¨çš„ 5601 ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„å¯¹åº”ç«¯å£ã€‚
# -d å‚æ•°ä½¿å®¹å™¨åœ¨åå°è¿è¡Œã€‚
# kibana:7.12.0 æ˜¯å…ˆå‰ä¸‹è½½çš„Kibanaé•œåƒã€‚
```

3. åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨ <http://your_server_ip:5601> è®¿é—® Kibana é¡µé¢ã€‚æ¬¢è¿é¡µé¢ï¼Œå®‰è£…æˆåŠŸã€‚
4. æ£€æŸ¥Kibanaæ˜¯å¦æ­£å¸¸è¿æ¥åˆ° Elasticsearchï¼š
    1. åœ¨ Kibana é¦–é¡µå•å‡»å·¦ä¾§å¯¼èˆªæ ä¸­çš„ "Management"ï¼Œ
    2. ç„¶åå•å‡» "Kibana" > "Index Patterns"ã€‚
    3. è¾“å…¥ "logstash-*" ä½œä¸º index pattern åç§°ï¼Œå•å‡» "Create" æŒ‰é’®ã€‚
    4. å¦‚æœèƒ½çœ‹åˆ°æˆåŠŸåˆ›å»ºç´¢å¼•æ¨¡å¼çš„æç¤ºï¼Œåˆ™è¡¨æ˜Kibanaå·²ç»æˆåŠŸè¿æ¥åˆ°Elasticsearchã€‚

> åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ --link my-es-container:elasticsearch å‘½ä»¤å°† Elasticsearch å®¹å™¨é“¾æ¥åˆ° Kibana å®¹å™¨ä¸­ï¼Œå…¶ä¸­ elasticsearch æ˜¯ Elasticsearch çš„é»˜è®¤ä¸»æœºåç§°ã€‚è¯·ç¡®ä¿Kibanaä¸­çš„ elasticsearch.hosts å‚æ•°ä¸æ­¤åç§°åŒ¹é…ï¼Œä»¥ä¾¿Kibanaæ­£ç¡®è¿æ¥åˆ° Elasticsearchã€‚


**å®‰è£… IK åˆ†è¯å™¨çš„æ­¥éª¤**:

1. æ‰“å¼€ç»ˆç«¯å¹¶è¿›å…¥ Elasticsearch å®¹å™¨ï¼š

```shell
docker exec -it es /bin/bash
```

2. ç¡®è®¤å½“å‰ç›®å½•ä½ç½®æ˜¯ Elasticsearch é…ç½®ç›®å½• /usr/share/elasticsearch/ã€‚
3. ä¸‹è½½ IK åˆ†è¯å™¨æ’ä»¶ï¼š

```shell
./bin/elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.12.0/elasticsearch-analysis-ik-7.12.0.zip
```

4. æ’ä»¶ä¸‹è½½å®Œæˆåï¼Œé‡å¯ Elasticsearch å®¹å™¨ä»¥ä½¿å…¶ç”Ÿæ•ˆã€‚
```shell
docker restart es
```
5. æ£€æµ‹æ’ä»¶æ˜¯å¦æˆåŠŸå®‰è£…ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ä¹‹ä¸€æ¥æµ‹è¯•ï¼š 
   - æ–¹å¼ä¸€ï¼šè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œç¡®ä¿ ik åˆ†è¯å™¨åœ¨å·²ç»å®‰è£…çš„åˆ†æå™¨ä¸­åˆ—å‡ºã€‚
   ```shell
   curl -X GET "localhost:9200/_analyze?pretty" -H 'Content-Type: application/json' -d'
   {
   "analyzer": "ik_max_word",
   "text": "ä½ å¥½ï¼Œæˆ‘æ˜¯é¡»è´ºï¼"
   }
   '
   ```
   - æ–¹å¼äºŒï¼šæ‰“å¼€ Kibanaï¼Œåˆ›å»ºä¸€ä¸ªç´¢å¼•æ¨¡å¼ï¼Œé€‰æ‹© "IK" åˆ†è¯å™¨ä½œä¸ºé»˜è®¤åˆ†è¯å™¨ã€‚éšåæ‚¨å°†èƒ½å¤Ÿä½¿ç”¨ "IK" åˆ†è¯å™¨è¿›è¡Œæœç´¢å’Œèšåˆæ“ä½œã€‚

**æ·»åŠ è‡ªå®šä¹‰æ‰©å±•åˆ†è¯**ï¼š
```shell
docker exec -it es /bin/bash

cd /usr/share/elasticsearch/config/analysis-ik

vi IKAnalyzer.cfg.xml 

#ä¿®æ”¹ IKAnalyzer.cfg.xml æ–‡ä»¶ï¼Œä»¥ä½¿å…¶èƒ½å¤ŸåŠ è½½æ–°çš„æ‰©å±•è¯åº“ã€‚
# åœ¨ <properties> æ ‡ç­¾ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š
# é…ç½®è‡ªå·±çš„æ‰©å±•è¯æ±‡
<entry key="ext_dict">ext.dic</entry> 
# æ’é™¤æ•æ„Ÿè¯æ±‡
<entry key="ext_stopwords">stopword.dic</entry> 

# æ³¨æ„ï¼Œext.dicå’Œstopword.dic æ˜¯å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œéœ€è¦æ–°å»ºï¼Œç„¶æ·»åŠ å³å¯
[root@f13848de9eca analysis-ik]# cat ext.dic 
é¡»è´º
ä½ å¥½
axcmsm

#åœ¨ Elasticsearch å®¹å™¨ä¸­é‡æ–°å¯åŠ¨æœåŠ¡ï¼Œä½¿æ›´æ”¹ç”Ÿæ•ˆã€‚
docker restart es

# æµ‹è¯•ï¼š
POST /_analyze
{
  "analyzer": "ik_max_word",
  "text": "ä½ å¥½ï¼Œæˆ‘æ˜¯é¡»è´ºï¼"
}



```


**IKåˆ†è¯å™¨æ¨¡å¼**ï¼š
- `ik_smart`ï¼šæ™ºèƒ½åˆ‡åˆ†ï¼Œç²—ç²’åº¦
- `ik_max_word`ï¼šæœ€ç»†åˆ‡åˆ†ï¼Œç»†ç²’åº¦

ä½œç”¨ï¼š
- åˆ›å»ºåˆ€ç‰‡ç´¢å¼•æ—¶å¯¹æ–‡æ¡£è¿›è¡Œåˆ†è¯
- ç”¨æˆ·æœç´¢æ—¶ï¼Œå¯¹è¾“å…¥çš„å†…å®¹åˆ†è¯


---

### DSLæ“ä½œæ¡ˆä¾‹

### ç´¢å¼•åº“æ“ä½œ

**mappingå±æ€§(å¸¸è§)**ï¼š
- type: å­—æ®µç±»å‹ï¼Œå¸¸è§ çš„ç±»å‹æœ‰ï¼š
  - å­—ç¬¦ä¸²ï¼štext(å¯åˆ†è¯æ–‡æœ¬)ï¼Œkeyword(ç²¾ç¡®å€¼ï¼Œä¾‹å¦‚ï¼šå“ç‰Œï¼Œå›½å®¶ï¼Œipåœ°å€)
  - æ•°å€¼ï¼šlongï¼Œinteger,short,byte,double,float
  - å¸ƒå°”å€¼ï¼šboolean
  - æ—¥æœŸï¼šdate
  - å¯¹è±¡ï¼šobject
- indexï¼šæ˜¯å¦åˆ›å»ºç´¢å¼•ï¼Œé»˜è®¤ä¸ºtrue ï¼ˆæ‹†åˆ†ï¼‰
- analyzerï¼šä½¿ç”¨é‚£ç§åˆ†è¯å™¨
- properties: è¯¥å­—æ®µçš„å­å­—æ®µ

**åˆ›å»ºç´¢å¼•åº“æ¡ˆä¾‹**ï¼š
```shell
PUT /axcmsm_test
{
  "mappings": {
    "properties": {
      "info":{
        "type": "text",
        "analyzer": "ik_smart"
      },
      "email":{
        "type": "keyword",
        "index": false 
      },
      "name":{
        "type": "object", 
        "properties": {
          "firstName":{
            "type":"keyword",
            "index":false
          },
          "lastName":{
            "type":"keyword"
          }
        }
      }
    }
  }
}
```
**æŸ¥è¯¢oråˆ é™¤ç´¢å¼•åº“**:
```shell
# æŸ¥è¯¢ç´¢å¼•åº“
GET /axcmsm_test

# åˆ é™¤ç´¢å¼•åº“
DELETE /axcmsm_test
```

**ä¿®æ”¹ç´¢å¼•åº“**:
> ç¦æ­¢ä¿®æ”¹ï¼Œæ”¯æŒæ·»åŠ ï¼Œå› ä¸ºå·²ç»å¯¹æŸäº›åˆ†è¯åˆ›å»ºäº†å€’æ’ç´¢å¼•åº“äº†ï¼Œå¦‚æœä¿®æ”¹æ˜¯éå¸¸æ¶ˆè€—æ€§èƒ½çš„ï¼Œä¸æ¨èä¿®æ”¹ï¼Œä½†å¯ä»¥æ·»åŠ ã€‚
```shell
PUT /axcmsm_test/_mapping
{
  "properties":{
      "age":{
        "type": "integer",
        "index": false
      }
  }
}
```
**æ€»ç»“**ï¼š
- åˆ›å»ºç´¢å¼•åº“ï¼šput /ç´¢å¼•åº“å
- æŸ¥è¯¢ç´¢å¼•åº“ï¼šget /ç´¢å¼•åº“å
- åˆ é™¤ç´¢å¼•åº“ï¼šdelete /ç´¢å¼•åº“å
- æ·»åŠ å­—æ®µï¼šput /ç´¢å¼•åº“/_mapping

---

### æ–‡æ¡£æ“ä½œ

**æ–°å¢æ–‡æ¡£**ï¼šä¸æŒ‡å®šidï¼Œä¼šéšæœºåˆ†é…id
```shell
POST /axcmsm_test/_doc/1
{
  "age":20,
  "email":"axcmsm@qq.com",
  "info":"å¤§å®¶å¥½ï¼æˆ‘æ˜¯é¡»è´ºï¼",
  "name":{
    "firstName":"é¡»",
    "lastName":"è´º"
  }
}
```
**æŸ¥è¯¢å’Œåˆ é™¤æ–‡æ¡£**ï¼š
```shell
# æŸ¥è¯¢
GET /axcmsm_test/_doc/1

# æ‰¹é‡æŸ¥è¯¢
GET /axcmsm_test/_search

# åˆ é™¤
DELETE /axcmsm_test/_doc/1
```
**ä¿®æ”¹æ–‡æ¡£**ï¼š
- æ–¹å¼ä¸€ï¼šå…¨é‡ä¿®æ”¹ï¼ˆåˆ é™¤æ—§æ–‡æ¡£ï¼Œæ·»åŠ æ–°æ–‡æ¡£ï¼‰=> å­˜åœ¨ä¿®æ”¹ï¼Œä¸å­˜åœ¨**æ–°å¢**
```shell
PUT /axcmsm_test/_doc/1
{
  "age":19,
  "email":"axcmsm@qq.com",
  "info":"å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯é¡»è´ºã€‚æ¬¢è¿æ¥åˆ°è¿™é‡Œï¼",
  "name":{
    "firstName":"é¡»",
    "lastName":"è´º"
  }
}
```
- æ–¹å¼äºŒï¼šå±€éƒ¨ä¿®æ”¹
```shell
POST /axcmsm_test/_update/1
{
  "doc":{
    "age":18
  }
}
```
**æ€»ç»“**ï¼š
- åˆ›å»ºæ–‡æ¡£ï¼šPOST /ç´¢å¼•åº“å/_doc/æ–‡æ¡£id {jsonæ–‡æ¡£}
- æŸ¥è¯¢æ–‡æ¡£ï¼šGET /ç´¢å¼•åº“å/_doc/æ–‡æ¡£id
- åˆ é™¤æ–‡æ¡£ï¼šDELETE /ç´¢å¼•åº“å/_doc/æ–‡æ¡£id
- ä¿®æ”¹æ–‡æ¡£ï¼š
  - å…¨é‡ä¿®æ”¹ï¼šPUT /ç´¢å¼•åº“/_doc/æ–‡æ¡£id {jsonæ–‡æ¡£}
  - å¢é‡ä¿®æ”¹ï¼šPOST /ç´¢å¼•åº“/_update/æ–‡æ¡£id {jsonæ–‡æ¡£}

### è¡¥å……
**åœ°ç†åæ ‡çš„mappingæ˜ å°„ç±»å‹**ï¼šä¿©ç§
- geo_pointï¼šç”±çº¬åº¦(latitude)å’Œç»åº¦(longitude) ç¡®å®šçš„ä¸€ä¸ªç‚¹
- geo_shape: ç”±å¤šä¸ªgeo_pointç»„æˆçš„å¤æ‚å‡ ä½•å›¾å½¢ã€‚
```shell
"localtion":{
  "type":"geo_point" 
}
```

**å­—æ®µæ‹·è´**ï¼šcopy_to å±æ€§ï¼Œå°†å½“å‰å­—æ®µæ‹·è´åˆ°æŒ‡å®šå­—æ®µã€‚
>è¦å‚ä¸æœç´¢çš„å­—æ®µï¼Œå¯ä»¥ä½¿ç”¨ä¸‹åˆ—è¿™ä¸ªæ–¹å¼.
```shell
"all":{
  "type":"text",
  "analyzer":"ik_max_word"
}
"brand":{
  "type":"keyword",
  "copy_to":"all"
}
```





### Apiæ“ä½œ
**Rest Client**: ç»„è£…DSLè¯­å¥ï¼Œç„¶åé€šè¿‡httpè¯·æ±‚å‘é€ç»™esã€‚


**å¯¼å…¥ä¾èµ–**ï¼š
```xml
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-data-elasticsearch</artifactId>
        </dependency>
```
**å°è£…beanå¯¹è±¡**ï¼š
```java
@Configuration
public class ElasticSearchClientConfig {
    //æ³¨å…¥bean å¼€å¯
    @Bean
    public RestHighLevelClient restHighLevelClient(){
        return new RestHighLevelClient(RestClient.builder(
                new HttpHost("192.168.64.101", 9200, "http")
//                new HttpHost("192.168.64.101", 9200, "http"),
//                new HttpHost("192.168.64.101", 9200, "http"),
        ));
    }
}
```
#### **ç´¢å¼•åº“æ“ä½œ**ï¼š indices
```java
@SpringBootTest
public class EsIndexTest {

    @Autowired
    private RestHighLevelClient restHighLevelClient;

    /**
     * åˆ›å»ºç´¢å¼•
     * @throws IOException
     */
    @Test
    void create_index() throws IOException {
        CreateIndexRequest indexRequest = new CreateIndexRequest("axcmsm_test");
        indexRequest.source(EsMappingConstant.AXCMSM_TEST_MAPPING, XContentType.JSON);
        restHighLevelClient.indices().create(indexRequest, RequestOptions.DEFAULT);
    }

    /**
     * åˆ é™¤æ“ä½œ
     * @throws IOException
     */
    @Test
    void delete_index() throws IOException {
        DeleteIndexRequest indexRequest = new DeleteIndexRequest("axcmsm_test");
        restHighLevelClient.indices().delete(indexRequest,RequestOptions.DEFAULT);
    }


    /**
     * åˆ¤æ–­ç´¢å¼•åº“æ˜¯å¦å­˜åœ¨
     * @throws IOException
     */
    @Test
    void exists_index() throws IOException {
        GetIndexRequest indexRequest=new GetIndexRequest("axcmsm_test");
        boolean exists = restHighLevelClient.indices().exists(indexRequest, RequestOptions.DEFAULT);
        System.err.println(exists);
    }
}
```
```java
public class EsMappingConstant {
    public static final String AXCMSM_TEST_MAPPING="{\n" +
            "  \"mappings\": {\n" +
            "    \"properties\": {\n" +
            "      \"info\":{\n" +
            "        \"type\": \"text\",\n" +
            "        \"analyzer\": \"ik_smart\"\n" +
            "      },\n" +
            "      \"email\":{\n" +
            "        \"type\": \"keyword\",\n" +
            "        \"index\": false \n" +
            "      },\n" +
            "      \"name\":{\n" +
            "        \"type\": \"object\", \n" +
            "        \"properties\": {\n" +
            "          \"firstName\":{\n" +
            "            \"type\":\"keyword\",\n" +
            "            \"index\":false\n" +
            "          },\n" +
            "          \"lastName\":{\n" +
            "            \"type\":\"keyword\"\n" +
            "          }\n" +
            "        }\n" +
            "      }\n" +
            "    }\n" +
            "  }\n" +
            "}";
}
```

#### **æ–‡æ¡£æ“ä½œ**ï¼š index,get,update,delete
```xml
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
        </dependency>
        <dependency>
            <groupId>com.alibaba</groupId>
            <artifactId>fastjson</artifactId>
            <version>2.0.25</version>
        </dependency>
```
```java
@Data
@NoArgsConstructor
@AllArgsConstructor
@ToString
public class AxcmsmTest {
    private String id;
    private String info;
    private Name name;
    @Data
    @NoArgsConstructor
    @AllArgsConstructor
    @ToString
    public static class Name{
        String firstName;
        String lastName;
    }
}
```
```java
@SpringBootTest
public class EsDocumentTest {
    @Autowired
    private RestHighLevelClient restHighLevelClient;

    /**
     * æ·»åŠ æ•°æ® æ¡ˆä¾‹ä¸€
     */
    @Test
    void add_data() throws IOException {
        IndexRequest indexRequest = new IndexRequest("axcmsm_test").id("1")
                .source(EsMappingConstant.AXCMSM_TEST_ADD, XContentType.JSON);
        IndexResponse index = restHighLevelClient.index(indexRequest, RequestOptions.DEFAULT);
        System.out.println(index.status());
    }

    /**
     * æ·»åŠ æ•°æ® æ¡ˆä¾‹æ¡ˆä¾‹äºŒ
     */
    @Test
    void add_data_object() throws IOException {
        AxcmsmTest pojo = new AxcmsmTest();
        pojo.setId("2");
        pojo.setInfo("æˆåŠŸçš„ç§˜è¯€åœ¨äºå¯¹ç›®æ ‡çš„è¿½æ±‚ï¼Œè€Œä¸æ˜¯å¯¹æ—¶é—´çš„ç­‰å¾…ã€‚");
        pojo.setName(new AxcmsmTest.Name("æ­Œ", "å¾·"));
        System.out.println(pojo);


        IndexRequest indexRequest = new IndexRequest("axcmsm_test").id(pojo.getId())
                .source(JSON.toJSONString(pojo), XContentType.JSON);
        IndexResponse index = restHighLevelClient.index(indexRequest, RequestOptions.DEFAULT);
        System.out.println(index.status());
    }

    /**
     * æ·»åŠ æ•°æ® æ¡ˆä¾‹æ¡ˆä¾‹ä¸‰
     * æ‰¹é‡æ“¦æ±—äºº
     */
    @Test
    void add_data_bulk() throws IOException {
        ArrayList<AxcmsmTest> list = new ArrayList<>();
        list.add(new AxcmsmTest("3","æˆåŠŸçš„ç§˜è¯€åœ¨äºå¯¹ç›®æ ‡çš„è¿½æ±‚ï¼Œè€Œä¸æ˜¯å¯¹æ—¶é—´çš„ç­‰å¾…1ã€‚",new AxcmsmTest.Name("æ­Œ1", "å¾·1")));
        list.add(new AxcmsmTest("4","æˆåŠŸçš„ç§˜è¯€åœ¨äºå¯¹ç›®æ ‡çš„è¿½æ±‚ï¼Œè€Œä¸æ˜¯å¯¹æ—¶é—´çš„ç­‰å¾…2ã€‚",new AxcmsmTest.Name("æ­Œ2", "å¾·2")));
        list.add(new AxcmsmTest("5","æˆåŠŸçš„ç§˜è¯€åœ¨äºå¯¹ç›®æ ‡çš„è¿½æ±‚ï¼Œè€Œä¸æ˜¯å¯¹æ—¶é—´çš„ç­‰å¾…3ã€‚",new AxcmsmTest.Name("æ­Œ3", "å¾·3")));

        BulkRequest request=new BulkRequest();
        for (AxcmsmTest item : list) {
            request.add(new IndexRequest("axcmsm_test").id(item.getId()).source(JSON.toJSONString(item),XContentType.JSON));
        }

        restHighLevelClient.bulk(request, RequestOptions.DEFAULT);
    }

    /**
     * æŸ¥è¯¢æ•°æ®
     */
    @Test
    void get_data() throws IOException {
        GetRequest indexRequest = new GetRequest("axcmsm_test").id("4");
        GetResponse response = restHighLevelClient.get(indexRequest, RequestOptions.DEFAULT);
        String json = response.getSourceAsString();
        System.out.println(json);
        AxcmsmTest axcmsmTest = JSON.parseObject(json, AxcmsmTest.class);
        System.out.println(axcmsmTest);
    }

    /**
     * æ›´æ–°æ•°æ®ï¼š
     * - å…¨é‡æ›´æ–°ï¼š è·Ÿæ–°å¢ä¸€æ ·
     * - å±€éƒ¨æ›´æ–°æ•°æ®
     */
    @Test
    void update_data() throws IOException {
        UpdateRequest indexRequest = new UpdateRequest("axcmsm_test", "2")
                .doc(
                        "info", "å®‰é™çš„è†å¬ç€å‘½è¿çš„æ‚²é¸£å§ï¼"
                );
        restHighLevelClient.update(indexRequest, RequestOptions.DEFAULT);
    }

    /**
     * åˆ é™¤æ–‡æ¡£
     * @throws IOException
     */
    @Test
    void delete_data() throws IOException {
        DeleteRequest indexRequest=new DeleteRequest("axcmsm_test","1");
        restHighLevelClient.delete(indexRequest, RequestOptions.DEFAULT);
    }
}
```


### æŸ¥è¯¢ ğŸŸ

[æ–‡æ¡£åœ°å€](https://www.elastic.co/guide/en/elasticsearch/reference/6.0/query-dsl-match-all-query.html)

åˆ†ç±»ï¼š
- æŸ¥è¯¢æ‰€æœ‰ï¼šæŸ¥è¯¢æ‰€æœ‰æ•°æ®ï¼Œä¸€èˆ¬æµ‹è¯•ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼šmatch_all
- å…¨æ–‡æ£€ç´¢æŸ¥è¯¢ï¼šåˆ©ç”¨åˆ†è¯å™¨å¯¹ç”¨æˆ·è¾“å…¥çš„å†…å®¹åˆ†è¯ï¼Œç„¶åå»å€’æ’ç´¢å¼•åº“ä¸­åŒ¹é…ï¼šä¾‹å¦‚ï¼š
  - match_query
  - multi_match_query
- ç²¾ç¡®æŸ¥è¯¢ï¼šæ ¹æ®ç²¾ç¡®æ­¤è¯æ¡å€¼æŸ¥æ‰¾æ•°æ®ï¼Œä¸€èˆ¬æ˜¯æŸ¥æ‰¾keywordã€æ•°å€¼ã€æ—¥æœŸã€booleanç­‰ç±»å‹å­—æ®µã€‚ä¾‹å¦‚ï¼š
  - ids
  - range
  - term
- åœ°ç†(geo)æŸ¥è¯¢:æ ¹æ®ç»çº¬åº¦æŸ¥è¯¢ã€‚ä¾‹å¦‚ï¼š
  - geo_distance
  - geo_bounding_box
- å¤åˆï¼ˆcompoundï¼‰æŸ¥è¯¢ï¼šå¤åˆæŸ¥è¯¢å¯ä»¥å°†ä¸Šè¿°å„ç§æŸ¥è¯¢æ¡ä»¶ç»„åˆèµ·æ¥ï¼Œåˆå¹¶æŸ¥è¯¢æ¡ä»¶ã€‚ä¾‹å¦‚ï¼š
  - bool
  - function_score

**åŸºæœ¬æŸ¥è¯¢æ¡ˆä¾‹DSL**:
```shell
# æŸ¥è¯¢æ‰€æœ‰æ•°æ® é»˜è®¤æŸ¥è¯¢10æ¡
GET /axcmsm_test/_search
{
"query": {
"match_all": {}
}
}

# å…¨æ–‡æ£€ç´¢æŸ¥è¯¢ match,multi_match
GET /axcmsm_test/_search
{
"query": {
"match": {
"info": "å‘½è¿"
}
}
}
# å¤šå­—æ®µæŸ¥è¯¢,æŸ¥è¯¢å­—æ®µè¶Šå¤šæ€§èƒ½è¶Šå·®ã€‚æ¨èä½¿ç”¨  copy_to çš„æ–¹å¼æŸ¥è¯¢ï¼ŒèŠ‚çœæ¶ˆè€—ã€‚
GET /axcmsm_test/_search
{
"query": {
"multi_match": {
"query": "æ‚²é¸£",
"fields": ["info","firstName"]
}
}
}

# ç²¾ç¡®æŸ¥è¯¢ ä¸€èˆ¬æ˜¯æŸ¥æ‰¾keyword,æ•°å€¼ï¼Œæ—¥æœŸï¼Œbooleanç­‰ç±»å‹çš„å­—æ®µï¼Œæ‰€ä»¥ä¸ä¼šå¯¹æœç´¢æ¡ä»¶è¿›è¡Œåˆ†è¯ã€‚
# term:ç²¾ç¡®(å®Œå…¨ä¸€è‡´) ï¼Œrangeï¼šèŒƒå›´æŸ¥è¯¢
GET /axcmsm_test/_search
{
"query": {
"term": {
"name.lastName": {
"value": "å¾·"
}
}
}
}
# rangeï¼šèŒƒå›´æŸ¥è¯¢
GET /axcmsm_test/_search
{
"query": {
"range": {
"id": {
"gte": 4,
"lte": 5
}
}
}
}

# åœ°ç†æŸ¥è¯¢ï¼šæ ¹æ®ç»çº¬åº¦æŸ¥è¯¢
# geo_bounding_box :æŸ¥è¯¢ geo_point å€¼è½åœ¨æŸä¸ªçŸ©å½¢èŒƒå›´çš„æ‰€æœ‰æ–‡æ¡£ã€‚ï¼ˆæŸä¸ªåŒºé—´å†…çš„æ‰€æœ‰è½¦è¾†ï¼‰
GET /axcmsm_test/_search
{
"query": {
"geo_bounding_box":{
"åœ°ç†åæ ‡ç±»å‹çš„å­—æ®µ":{
"top_left":{
"lat":31.1,
"lon": 121.5
},
"bottom_right":{
"lat":30.8,
"lon":121.7
}
}
}
}
}

# geo_distance: æŸ¥è¯¢åˆ°æŒ‡å®šä¸­å¿ƒç‚¹å°äºæŸä¸ªè·ç¦»å€¼çš„æ‰€æœ‰æ–‡æ¡£ã€‚ geo_pointç±»å‹å­—æ®µ ï¼ˆæˆ‘é™„è¿‘çš„15kmçš„è½¦è¾†)
GET /axcmsm_test/_search
{
"query": {
"geo_distance":{
"distance":"15km",
"åœ°ç†åæ ‡ç±»å‹å­—æ®µ":"31,21,121.5"
}
}
}
```

**å¤æ‚èšåˆæŸ¥è¯¢**: 

**ç›¸å…³æ€§ç®—åˆ†**:
![å¤æ‚èšåˆæŸ¥è¯¢](./img/3.1.3img.png)
- è¿‡æ»¤æ¡ä»¶ï¼šè¿‡æ»¤å‡ºå“ªäº›æ–‡æ¡£éœ€è¦åŠ åˆ†
- ç®—åˆ†å‡½æ•°ï¼šå¦‚ä½•è®¡ç®—åˆ†æ•°
- åŠ æƒæ–¹å¼ï¼šfunction score ä¸ query score å¦‚ä½•è¿ç®—
> ä¾‹å¦‚ï¼šç™¾åº¦æœç´¢ï¼ŒæŸä¸ªå•†å“ï¼Œçœ‹é‚£ä¸ªæœ€é å‰ã€‚(å¹¿å‘Šä¹Ÿä¼šé å‰)
```shell
# å¤åˆæŸ¥è¯¢
# ç›¸å…³æ€§ç®—åˆ†
# function score  ç»™ â€å¾·2â€œ è¿›è¡ŒåŠ æƒç®—åˆ† è®©å…¶æ’ç¬¬ä¸€ _score 
GET /axcmsm_test/_search
{
  "query": {
    "function_score": {
      "query": {
        "match": {
          "info": "ç­‰å¾…"
        }
      },
      "functions": [
        {
          "filter": {
            "term": {
              "name.lastName": "å¾·2"
            }
          },
          "weight": 10
        }
      ],
      "score_mode": "sum"
    }
  }
}
```

**Boolean Query(å¸ƒå°”æŸ¥è¯¢)**ï¼šå°†ä¸€ä¸ªæˆ–å¤šä¸ªæŸ¥è¯¢å­å¥ç»„åˆèµ·æ¥ï¼Œå½¢æˆæ–°çš„æŸ¥è¯¢æ¡ä»¶ã€‚
- must:å¿…é¡»åŒ¹é…æ¯ä¸ªå­æŸ¥è¯¢ï¼Œç±»ä¼¼â€ä¸â€œ
- should:é€‰æ‹©æ€§åŒ¹é…å­æŸ¥è¯¢ï¼Œç±»ä¼¼â€æˆ–â€œ
- must_not:å¿…é¡»ä¸åŒ¹é…ï¼Œä¸å‚ä¸ç®—åˆ†ï¼Œç±»ä¼¼â€éâ€œ
- filterï¼šå¿…é¡»åŒ¹é…ï¼Œä¸å‚ä¸ç®—åˆ†
> ä¾‹å¦‚ï¼šäº¬ä¸œæœç´¢å•†å“ï¼Œå¯ä»¥é€‰æ‹©å“ç‰Œå’Œå‚å•†ç­‰å¤šæ¡ä»¶å¤åˆæŸ¥è¯¢
```shell
GET /axcmsm_test/_search
{
  "query": {
    "bool": {
      "must": [
        {
          "term": {
            "name.lastName":"å“ç‰Œåç§°"
          }
        }
      ],
      "must_not": [
        {
          "range": {
            "id": {
              "gte": 1,
              "lte": 2
            }
          }
        }
      ],
      "filter": [
        {
          "term": {
            "id": "å‚å•†id"
          }
        }
      ]
    }
  }
}
```

#### æŸ¥è¯¢ç»“æœå¤„ç†  
**æ’åº**ï¼šé»˜è®¤æ˜¯æ ¹æ®ç›¸å…³åº¦ç®—åˆ†ï¼ˆ_score) æ¥æ’åºã€‚å¯ä»¥æ’åºçš„å­—æ®µç±»å‹æœ‰ï¼škeywordç±»å‹ï¼Œæ•°å€¼ç±»å‹ï¼Œåœ°ç†åæ ‡ç±»å‹ï¼Œæ—¥æœŸç±»å‹ç­‰ã€‚
> æ’åºåï¼Œå°±é»˜è®¤çš„æ”¾å¼ƒæ‰“åˆ†çš„è§„åˆ™
```shell
# æ’åºç®€å• 
GET /axcmsm_test/_search
{
  "query": {
    "match_all": {}
  },
  "sort": [
    {
      "_id": "desc"
    }
  ]
}
# åœ°ç†åæ ‡æ’åº  
GET /axcmsm_test/_search
{
  "query": {
    "match_all": {}
  },
  "sort": [
    {
      "_geo_distance": {
        "order": "asc",
        "unit": "km",
        "å­—æ®µ":"çº¬åº¦,ç»åº¦"
      }
    }
  ]
}
```

**åˆ†é¡µ**:
```shell
# åˆ†é¡µæŸ¥è¯¢
# from èµ·å§‹ä½ç½®ï¼Œé»˜è®¤æ˜¯0ï¼Œsizeæ¯é¡µå¤šå°‘æ¡ã€‚ é»˜è®¤ï¼šfrom+size ä¸èƒ½è¶…è¿‡10000æ¡
GET /axcmsm_test/_search
{
  "query": {
    "match_all": {}
  },
  "from": 2,
  "size": 10,
  "sort": [
    {
      "_id": {
        "order": "asc"
      }
    }
  ]
}
```
**åˆ†é¡µè§£å†³æ–¹æ¡ˆ**ï¼š
- **from+size**:
  - ä¼˜ç‚¹ï¼šæ”¯æŒéšæœºåˆ†é¡µ
  - ç¼ºç‚¹ï¼šæ·±åº¦åˆ†é¡µé—®é¢˜ï¼Œé»˜è®¤æŸ¥è¯¢ä¸Šé™ï¼ˆfrom+size)æ˜¯10000
  - åœºæ™¯ï¼šç™¾åº¦ï¼Œäº¬ä¸œï¼Œè°·æ­Œï¼Œæ·˜å®è¿™æ ·çš„éšæœºç¿»é¡µæœç´¢
- search afterï¼šåˆ†é¡µæ—¶éœ€è¦æ’åºï¼ŒåŸç†æ˜¯ä»ä¸Šä¸€æ¬¡çš„æ’åºå€¼å¼€å§‹ï¼ŒæŸ¥è¯¢ä¸‹ä¸€é¡µæ•°æ®ã€‚
  - ä¼˜ç‚¹ï¼šæ²¡æœ‰æŸ¥è¯¢ä¸Šé™ï¼ˆå•æ¬¡æŸ¥è¯¢çš„sizeä¸è¶…è¿‡10000ï¼‰
  - ç¼ºç‚¹ï¼šæ™ºèƒ½å‘åé€é¡µæŸ¥è¯¢ï¼Œä¸æ”¯æŒéšæœºç¿»é¡µ
  - åœºæ™¯ï¼šæ²¡æœ‰éšæœºç¿»é¡µéœ€æ±‚çš„æœç´¢ï¼Œä¾‹å¦‚ï¼šæ‰‹æœºå‘ä¸‹æ»šåŠ¨ç¿»é¡µã€‚
- scrollï¼šåŸç†å°†æ’åºå½¢æˆå¿«ç…§ï¼Œä¿å­˜åœ¨å†…å­˜ã€‚å®˜æ–¹ä¸æ¨èä½¿ç”¨ã€‚
  - ä¼˜ç‚¹ï¼šæ²¡æœ‰æŸ¥è¯¢ä¸Šé™ï¼ˆå•æ¬¡æŸ¥è¯¢çš„sizeä¸è¶…è¿‡10000ï¼‰
  - ç¼ºç‚¹ï¼šå†…å­˜æ¶ˆè€—å¤§ï¼Œå¹¶ä¸”æœç´¢ç»“æœæ˜¯éå®æ—¶çš„
  - åœºæ™¯ï¼šæµ·é‡æ•°æ®çš„è·å–å’Œè¿ç§»ã€‚ä»ES7.1å¼€å§‹ä¸æ¨è.
  

**é«˜äº®**:
```shell
# é«˜äº®æ˜¾ç¤º,é»˜è®¤æƒ…å†µä¸‹ï¼ŒESæœç´¢çš„å­—æ®µå¿…é¡»ä¸é«˜äº®å­—æ®µä¸€è‡´
# å¦‚æœä¸ä¸€è‡´ï¼Œéœ€è¦åŠ ä¸Šï¼Œ "require_field_match": "false"
GET /axcmsm_test/_search
{
  "query": {
    "match": {
      "info": "å‘½è¿"
    }
  },
  "highlight": {
    "fields": {
      "info": {
        "pre_tags": "<span style='color:red'>",
        "post_tags": "</span>"
      }
    }
  }
}
```

### APIæŸ¥è¯¢
```java
@SpringBootTest
public class EsSearchTest {
    @Autowired
    private RestHighLevelClient restHighLevelClient;

    /**
     * æŸ¥è¯¢å…¨éƒ¨ï¼šå¿«é€Ÿå…¥é—¨
     *
     * @throws IOException
     */
    @Test
    void MatchAllTest() throws IOException {
        SearchRequest searchRequest = new SearchRequest("axcmsm_test");
        searchRequest.source().query(QueryBuilders.matchAllQuery());
        SearchResponse search = restHighLevelClient.search(searchRequest, RequestOptions.DEFAULT);

        // å°è£…æ‰“å°ç»“æœé›†
        handleRes(search);
    }

    /**
     * å°è£…æ™®é€šæ‰“å°ç»“æœé›†
     *
     * @param search
     */
    private void handleRes(SearchResponse search) {
        SearchHits hits = search.getHits();
        long count = hits.getTotalHits().value;
        System.out.println("ä¸€å…±ï¼š" + count + "æ¡");
        for (SearchHit hit : hits.getHits()) {
            String json = hit.getSourceAsString();
            System.out.println(json);
        }
    }

    /**
     * åŒ¹é…æŸ¥è¯¢
     *
     * @throws IOException
     */
    @Test
    void QueryTest() throws IOException {
        SearchRequest searchRequest = new SearchRequest("axcmsm_test");

        //å•å­—æ®µæŸ¥è¯¢ï¼Œå¦‚æœé…ç½®äº†copy_to å¯ä»¥ä½¿ç”¨å•å­—æ®µï¼Œä»£æ›¿å¤šå­—æ®µï¼Œæå‡æ€§èƒ½
        MatchQueryBuilder matchQueryBuilder = QueryBuilders.matchQuery("info", "å‘½è¿");

        //å¤šå­—æ®µæŸ¥è¯¢ï¼Œå¦‚æœé…ç½®äº†copy_to å¯ä»¥ä½¿ç”¨å•å­—æ®µï¼Œä»£æ›¿å¤šå­—æ®µï¼Œæå‡æ€§èƒ½
        MultiMatchQueryBuilder multiMatchQueryBuilder = QueryBuilders.multiMatchQuery("6", "id", "info");

        //ç²¾ç¡®æŸ¥è¯¢
        TermQueryBuilder termQueryBuilder = QueryBuilders.termQuery("id", "2");

        //èŒƒå›´æŸ¥è¯¢
        RangeQueryBuilder rangeQueryBuilder = QueryBuilders.rangeQuery("id").gte(3).lte(6);

        //å¸ƒå°”æŸ¥è¯¢
        BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery()
                .must(QueryBuilders.termQuery("id", "3"))
                .filter(QueryBuilders.rangeQuery("id").gte(3).lte(6));


        //å¹¿å‘Šæƒé‡ç½®é¡¶
        FunctionScoreQueryBuilder functionScoreQueryBuilder = QueryBuilders.functionScoreQuery(
                QueryBuilders.matchQuery("name", "å‘½è¿"),
                new FunctionScoreQueryBuilder.FilterFunctionBuilder[]{
                        new FunctionScoreQueryBuilder.FilterFunctionBuilder(
                                // é‚£ä¸ªæäº†é’± => è¿‡æ»¤
                                QueryBuilders.termQuery("name", "é¡»è´º"),
                                // é™¶äº†å¤šå°‘ => æƒé‡
                                ScoreFunctionBuilders.weightFactorFunction(5)
                        )
                }
        );


        searchRequest.source().query(
//                matchQueryBuilder
//                multiMatchQueryBuilder
//                termQueryBuilder
                rangeQueryBuilder
//                boolQueryBuilder
        );


        //åˆ†é¡µ
        int page = 1, size = 2;
        searchRequest.source().from((page - 1) * size).size(size);

        //æ’åº
        searchRequest.source().sort("_id", SortOrder.DESC);

        //ç¦»æˆ‘æœ€è¿‘çš„ä½ç½®
        //searchRequest.source().sort(
        //       SortBuilders.geoDistanceSort("location",new GeoPoint("21,21,131.5"))
        //               .order(SortOrder.ASC)
        //               .unit(DistanceUnit.KILOMETERS)
        // );
        //è·ç¦»ç»“æœåœ¨ï¼šsorté‡Œé¢
        //

        SearchResponse search = restHighLevelClient.search(searchRequest, RequestOptions.DEFAULT);

        // å–ç»“æœé›†
        handleRes(search);
    }

    /**
     * é«˜äº®æ„å»ºå’Œè§£æ
     *
     * @throws IOException
     */
    @Test
    void MatchHighTest() throws IOException {
        SearchRequest searchRequest = new SearchRequest("axcmsm_test");
        searchRequest.source().query(QueryBuilders.matchQuery("info", "å‘½è¿"));

        //æ„å»ºé«˜äº®
        searchRequest.source().highlighter(
                new HighlightBuilder().field("info")
                        //æ˜¯å¦éœ€è¦è·ŸæŸ¥è¯¢å­—æ®µåŒ¹é…
                        .requireFieldMatch(false)
                        .preTags("<span style='color:red'>")
                        .postTags("</span>")
        );

        SearchResponse search = restHighLevelClient.search(searchRequest, RequestOptions.DEFAULT);

        // è§£æé«˜äº®
        SearchHits hits = search.getHits();
        long count = hits.getTotalHits().value;
        System.out.println("ä¸€å…±ï¼š" + count + "æ¡");
        for (SearchHit hit : hits.getHits()) {
            String json = hit.getSourceAsString();
            //è·å–å¯¹è±¡
            JSONObject object = JSON.parseObject(json);
            //è·å–é«˜äº®ç»“æœ
            Map<String, HighlightField> highlightFields = hit.getHighlightFields();
            if (!CollectionUtils.isEmpty(highlightFields)) {
                HighlightField field = highlightFields.get("info");
                if (field != null) {
                    object.put("info", field.getFragments()[0].toString());
                }
            }
            System.out.println(object);
        }
    }
}
```


